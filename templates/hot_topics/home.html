<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Hot Topics</title>
    <style>
      body { font-family: Arial, sans-serif; margin: 24px; }
      h1, h2 { margin-bottom: 8px; }
      .muted { color: #555; }
      .card { border: 1px solid #ddd; border-radius: 8px; padding: 12px; margin-bottom: 14px; }
      ul { margin: 8px 0; padding-left: 20px; }
      a { color: #0d5cad; text-decoration: none; }
      a:hover { text-decoration: underline; }
    </style>
  </head>
  <body>
    <h1>Hot Topics</h1>
    <p class="muted">Top 20 trending posts across categories.</p>

    <div class="card">
      <h2>Global Top 20</h2>
      {% if global_hot %}
      <ul>
        {% for item in global_hot %}
        <li>
          #{{ item.rank }} [{{ item.post.topic.category.name }} / {{ item.post.topic.name }}]
          {{ item.post.title }} (score {{ item.score|floatformat:2 }})
        </li>
        {% endfor %}
      </ul>
      {% else %}
      <p>No ranking data yet. Run: <code>python manage.py rebuild_hot_topics</code></p>
      {% endif %}
    </div>

    <h2>Categories</h2>
    {% for section in category_sections %}
    <div class="card">
      <h3><a href="/category/{{ section.category.slug }}/">{{ section.category.name }}</a></h3>
      {% if section.top_posts %}
      <ul>
        {% for item in section.top_posts %}
        <li>#{{ item.rank }} {{ item.post.title }}</li>
        {% endfor %}
      </ul>
      {% else %}
      <p class="muted">No hot posts yet in this category.</p>
      {% endif %}
    </div>
    {% empty %}
    <p>No categories found. Seed sample data first.</p>
    {% endfor %}
  </body>
</html>
